<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  

<mapper namespace="com.weasy.admin.service.UserMapper">

<!-- management -->
	<select id="managementList" resultType="UserVO">
		select userName, userEmail, phoneNum, birth, gender, permission from users;
	</select>

<!-- userList -->
	<select id="userList" resultType="UserVO">
		select a.*,
		(select loginDate from loginlog b where b.userEmail = a.userEmail order by loginDate desc limit 1) 
		최신기록
		from users a;
	</select>
	
<!-- Pw Reset -->
	<update id="pwReset">
		update users set userPw=#{birth} where userEmail=#{userEmail};
	</update>
	
<!-- 가입 승인 -->
	<update id="permission" >
		UPDATE USERS set permission="Y" where userEmail=#{userEmail};
	</update>	
	
<!-- 권한 박탈 -->
	<update id="authority" >
		UPDATE USERS set permission="N" where userEmail=#{userEmail};
	</update>	
	
<!-- 관리자추가 -->
	<select id="admin" resultType="AdminVO">
		select userName, userEmail, memo, role from admins;
	</select>
	
<!-- 관리자회원가입 모당 -->
	
	<insert id="adminJoin" >
		insert into admins 
		(userEmail, userPw, userName, phoneNum, memo, role)
		values (#{userEmail}, #{userPw}, #{userName}, #{phoneNum},#{memo}, #{role});
	</insert>
	
	<!-- 이메일중복검사 -->
	<select id="idCheck" parameterType="String" resultType="int">
		SELECT COUNT(userEmail) FROM admins WHERE userEmail= #{id}
	</select>
</mapper>


